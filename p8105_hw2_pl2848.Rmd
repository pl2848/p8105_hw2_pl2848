---
title: "p8105_hw2_pl2848"
author: "Pei Liu"
date: "2022-10-01"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

Problem 1

Read the data and clean column names
```{r}
transit_df = read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() 

transit_clean

```

Retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance. Convert the entry variable from character (YES vs NO) to a logical variable (the ifelse or recode function may be useful).
```{r}
transit_clean = 
  pivot_longer(
    transit_df,
    route1:route11,
    names_to = "route_number",
    names_prefix = "route",
    values_to = "route_name",
    values_drop_na = TRUE,
    values_transform = as.character
  )%>% 
   # the pivot longer variable is to tidy the route data to all served routes
  mutate(entry = as.logical(entry == "YES"),
         route_served = paste(route_number,route_name,sep="-")) %>% # change the entry variable from character to a logical variable
  relocate(route_served, .after = station_longitude) %>% 
  relocate(ada, .after = vending) %>% 
  relocate(entrance_type, .after = vending) %>% # arrange the order of specific columns according to the requirement on the website
  select(line:ada,-exit_only) %>% # select the variables we want to retain
  arrange()

transit_clean

```


# Questions:
How many distinct stations are there? Note that stations are identified both by name and by line (e.g. 125th St 8th Avenue; 125st Broadway; 125st Lenox); the distinct function may be useful here.

Answer: 465
```{r}
nrow(distinct(transit_clean, line, station_name))
```


How many stations are ADA compliant?

Answer: 84
```{r}
unique_station_ada = transit_clean %>% 
  group_by(line, station_name) %>% 
  filter(ada == TRUE)
unique_station_ada
```


What proportion of station entrances / exits without vending allow entrance?

10.47%

```{r}
nrow(filter(transit_clean, vending == "NO"))

nrow(transit_clean)
894/8540
```


Reformat data so that route number and route name are distinct variables. How many distinct stations serve the A train? Of the stations that serve the A train, how many are ADA compliant?

Answer: Number of distinct stations serve the A train is 273. AN 107 of them are ADA complicant.

```{r}
transit_reformat = 
  pivot_longer(
    transit_df,
    route1:route11,
    names_to = "route_number",
    names_prefix = "route",
    values_to = "route_name",
    values_drop_na = TRUE,
    values_transform = as.character
  )%>% 
   # the pivot longer variable is to tidy the route data to all served routes
  mutate(entry = as.logical(entry == "YES")) %>% # change the entry variable from character to a logical variable
  relocate(route_number:route_name, .after = station_longitude) %>% 
  relocate(ada, .after = vending) %>% 
  relocate(entrance_type, .after = vending) %>% # arrange the order of specific columns according to the requirement on the website
  select(line:ada,-exit_only) %>% # select the variables we want to retain
  arrange()

transit_reformat
```
```{r}
num_station_a = transit_reformat %>% 
  filter(route_name == "A") %>% 
  nrow()

num_station_a

num_ada_com = transit_reformat %>% 
  filter(route_name == "A", ada == TRUE) %>% 
  nrow()
num_ada_com
```


# Problem 2
Read and clean the Mr. Trash Wheel sheet:

specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
```{r}
library(readxl)
```

use reasonable variable names, omit rows that do not include dumpster-specific data, round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)
```{r}
mr_trash_wheel = read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", "Mr. Trash Wheel", skip = 1, range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(sports_balls = as.integer(round(sports_balls,
                                         digits = 0)),
         dumpster = as.numeric(dumpster))
         
mr_trash_wheel
```
Use a similar process to import, clean, and organize the data for Professor Trash Wheel
```{r}
professor_trash_wheel = read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", "Professor Trash Wheel", skip = 1, range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(sports_balls = as.integer(round(sports_balls,
                                         digits = 0)),
         dumpster = as.numeric(dumpster))

professor_trash_wheel
```
add an additional variable to both datasets before combining.
```{r}
mr_trash_wheel = mutate(mr_trash_wheel, trash_wheel_name = "Mr. Trash")
professor_trash_wheel = mutate(professor_trash_wheel, trash_wheel_name = "Professor")
```

combine this with the Mr. Trash Wheel dataset to produce a single tidy dataset
```{r}
combine_trash_wheel = full_join(mr_trash_wheel, professor_trash_wheel)
combine_trash_wheel
```

Write a paragraph about these data:
There are 453 rows and 14 columns in mr_trash_wheel




what was the total weight of trash collected by Professor Trash Wheel?

Answer: 135.5 tons
```{r}
sum_weight = sum(professor_trash_wheel$weight_tons)

sum_weight
```

What was the total number of sports balls collected by Mr. Trash Wheel in 2020?

Answer: 856

```{r}
mr_trash_wheel_2020 = filter(mr_trash_wheel, year == 2020)
num_sport_balls_2020 =  sum(mr_trash_wheel_2020$sports_balls)
num_sport_balls_2020
```

# Problem 3
First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.
```{r}
pols_month = read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day")) %>% 
  mutate(month = month.abb[as.numeric(month)]) %>% 
  pivot_longer(starts_with("prez"),
               names_to = "president",
               names_prefix = "prez_",
               values_to = "party",
               values_drop_na = TRUE) %>% 
  filter(party == 1) %>% 
  select(-party, -day)
pols_month
```

Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.
```{r}
snp = read_csv("./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = as.Date(as.character(date), format = "%d/%m/%y")) %>% 
  separate(date, into=c("year", "month", "day")) %>% 
  arrange(year, month)
snp
```

Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.
```{r}
unemployment = read_csv("./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(jan:dec,
               names_to = "month",
               values_to = "unemployment_rate",
               values_drop_na = TRUE)

unemployment
```

